apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: cron-send-message
  namespace: default
spec:
  schedule: "*/1 * * * *"
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: send-message
            image: "caesarteam/caesar-server:develop"
            command: ["/usr/local/bin/php", "bin/console", "rabbitmq:consumer", "-e", "prod", "-w", "-m", "30", "send_message"]
            envFrom:
            - configMapRef:
                name: caesarapp-config
            - secretRef:
                name: caesarapp-secret
            - configMapRef:
                name: rabbitmq-config
            - secretRef:
                name: rabbitmq-secret
          restartPolicy: OnFailure

---
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: cron-clear-message-history
  namespace: default
spec:
  schedule: "0 12 * * *"
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: clear-message-history
            image: "caesarteam/caesar-server:develop"
            command: ["/usr/local/bin/php", "bin/console", "app:clear-message-history", "-e", "prod"]
            envFrom:
            - secretRef:
                name: caesarapp-secret
          restartPolicy: OnFailure
